
<h1><%= link_to "#{@pool.title} #{@pool.event.title}", pool_path(@pool) %> / <%= @user.name %></h1>

<%= form_for @user, :url => pool_player_path( @pool, @user ), :html => { :method => "put" } do |f| %>  

<table>
<% first_field = true %>
<% @groups.each do |group| %>
<tr>
  <td></td><td colspan='3'><b><%= group.title %></b></td>
</tr>
  <% group.games.each do |game| %>
  <% tip = Tip.find_by_user_and_pool_and_game( @user, @pool, game ) %>
   <tr>
    <td style='text-align: right;'> 
        <b>
          <% if game.team1.calc? %>
             <em>[<%= game.team1.title %>]</em>
          <% else %>  
             <%= game.team1.title %>
          <% end %>
        </b>
       <% if game.team1.img.present? %>
          <%= image_tag( game.team1.img ) %>
       <% end %>          
    </td>

   <% if game.over?  %>
     <td style='text-align: center;'>
      <b><%= game.score1 %></b>
       :
      <b><%= game.score2 %></b>
     </td>
   <% else %>
   <% if tip.present? %>
     <td>
  <%= f.fields_for 'tips[]', tip do |ff| %>
     <%= ff.hidden_field :user_id %>
     <%= ff.hidden_field :pool_id %>
     <%= ff.hidden_field :game_id %>
     <% if first_field %>
       <%= ff.text_field :score1, :size => 2, 'data-autofocus' => 'true' %>
       <% first_field = false %>
      <% else %>
       <%= ff.text_field :score1, :size => 2 %>
      <% end %>
       :
     <%= ff.text_field :score2, :size => 2 %>   
  <% end %><!-- fields_for tips -->
     </td>
       <% else %><!-- tip.present? -->
          <td>###<!-- fehler: datensatz fehlt! --></td>
       <% end %>
   <% end %> <!-- game.over? -->
    
       <td>
      <% if game.team2.img.present? %>
         <%= image_tag( game.team2.img ) %>
      <% end %>
        <b>
          <% if game.team2.calc? %>
             <em>[<%= game.team2.title %>]</em>
          <% else %>  
             <%= game.team2.title %>
          <% end %>
         </b>
       </td>
       <td>
           <span class='light'>        
              <%= game.play_at.strftime( "%a. %d. %b. / %H:%M" ) %>
           </span>
       </td>
   </tr>
  <% end %><!-- game -->
<% end %><!-- groups -->
</table>


<p>
  <%= f.submit "Tipps speichern", :class => 'btn-primary' %>
  <%= link_to 'ZurÃ¼ck', pool_path( @pool ), :class => 'btn' %>
</p>  
<% end %>  